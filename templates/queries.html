<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Queries Table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .wrap-text {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="mb-4">User Queries</h2>
    <div id="queriesAccordion" class="accordion"></div>
</div>

<script>
    async function loadQueries() {
        const res = await fetch("/api/user-queries");
        const data = await res.json();

        const container = document.getElementById("queriesAccordion");
        container.innerHTML = "";

        data.forEach((row, index) => {
            const card = document.createElement("div");
            card.className = "accordion-item mb-2";

            card.innerHTML = `
                <h2 class="accordion-header" id="heading${index}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}">
                        ${row.departure} → ${row.arrival} on ${row.travel_date}
                    </button>
                </h2>
                <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#queriesAccordion">
                    <div class="accordion-body">
                        <strong>User Prompt:</strong>
                        <p class="wrap-text text-muted">${row.user_prompt || "—"}</p>
                        <strong>Optimized Prompt:</strong>
                        <p class="wrap-text text-dark">${row.optimized_user_prompt || "—"}</p>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    window.onload = loadQueries;
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
